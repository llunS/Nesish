#include "console/cpu/cpu.hpp"

#include "console/cpu/instr_impl.hpp"

#define CORE(i_name) CPU::InstrImpl::core_##i_name
#define FRM(i_name) CPU::InstrImpl::frm_##i_name

namespace ln {

CPU::InstrDesc CPU::s_instr_table[256] = {
    // http://www.oxyron.de/html/opcodes02.html
    /* clang-format off */
    // -- 0x
    {CORE(nop), AddrMode::IMP, FRM(brk)},
    {CORE(ora), AddrMode::IZX, FRM(izx_r)},
    {CORE(kil), AddrMode::IMP, FRM(imp)},
    {CORE(slo), AddrMode::IZX, FRM(izx_rmw)},
    {CORE(nop), AddrMode::ZP0, FRM(zp_r)},
    {CORE(ora), AddrMode::ZP0, FRM(zp_r)},
    {CORE(asl), AddrMode::ZP0, FRM(zp_rmw)},
    {CORE(slo), AddrMode::ZP0, FRM(zp_rmw)},
    {CORE(nop), AddrMode::IMP, FRM(php)},
    {CORE(ora), AddrMode::IMM, FRM(imm)},
    {CORE(asl), AddrMode::ACC, FRM(acc)},
    {CORE(anc), AddrMode::IMM, FRM(imm)},
    {CORE(nop), AddrMode::ABS, FRM(abs_r)},
    {CORE(ora), AddrMode::ABS, FRM(abs_r)},
    {CORE(asl), AddrMode::ABS, FRM(abs_rmw)},
    {CORE(slo), AddrMode::ABS, FRM(abs_rmw)},
    // -- 1x
    {CORE(bpl), AddrMode::REL, FRM(rel)},
    {CORE(ora), AddrMode::IZY, FRM(izy_r)},
    {CORE(kil), AddrMode::IMP, FRM(imp)},
    {CORE(slo), AddrMode::IZY, FRM(izy_rmw)},
    {CORE(nop), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(ora), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(asl), AddrMode::ZPX, FRM(zpx_rmw)},
    {CORE(slo), AddrMode::ZPX, FRM(zpx_rmw)},
    {CORE(clc), AddrMode::IMP, FRM(imp)},
    {CORE(ora), AddrMode::ABY, FRM(aby_r)},
    {CORE(nop), AddrMode::IMP, FRM(imp)},
    {CORE(slo), AddrMode::ABY, FRM(aby_rmw)},
    {CORE(nop), AddrMode::ABX, FRM(abx_r)},
    {CORE(ora), AddrMode::ABX, FRM(abx_r)},
    {CORE(asl), AddrMode::ABX, FRM(abx_rmw)},
    {CORE(slo), AddrMode::ABX, FRM(abx_rmw)},
    // -- 2x
    {CORE(nop), AddrMode::ABS, FRM(jsr)},
    {CORE(and), AddrMode::IZX, FRM(izx_r)},
    {CORE(kil), AddrMode::IMP, FRM(imp)},
    {CORE(rla), AddrMode::IZX, FRM(izx_rmw)},
    {CORE(bit), AddrMode::ZP0, FRM(zp_r)},
    {CORE(and), AddrMode::ZP0, FRM(zp_r)},
    {CORE(rol), AddrMode::ZP0, FRM(zp_rmw)},
    {CORE(rla), AddrMode::ZP0, FRM(zp_rmw)},
    {CORE(nop), AddrMode::IMP, FRM(plp)},
    {CORE(and), AddrMode::IMM, FRM(imm)},
    {CORE(rol), AddrMode::ACC, FRM(acc)},
    {CORE(anc), AddrMode::IMM, FRM(imm)},
    {CORE(bit), AddrMode::ABS, FRM(abs_r)},
    {CORE(and), AddrMode::ABS, FRM(abs_r)},
    {CORE(rol), AddrMode::ABS, FRM(abs_rmw)},
    {CORE(rla), AddrMode::ABS, FRM(abs_rmw)},
    // -- 3x
    {CORE(bmi), AddrMode::REL, FRM(rel)},
    {CORE(and), AddrMode::IZY, FRM(izy_r)},
    {CORE(kil), AddrMode::IMP, FRM(imp)},
    {CORE(rla), AddrMode::IZY, FRM(izy_rmw)},
    {CORE(nop), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(and), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(rol), AddrMode::ZPX, FRM(zpx_rmw)},
    {CORE(rla), AddrMode::ZPX, FRM(zpx_rmw)},
    {CORE(sec), AddrMode::IMP, FRM(imp)},
    {CORE(and), AddrMode::ABY, FRM(aby_r)},
    {CORE(nop), AddrMode::IMP, FRM(imp)},
    {CORE(rla), AddrMode::ABY, FRM(aby_rmw)},
    {CORE(nop), AddrMode::ABX, FRM(abx_r)},
    {CORE(and), AddrMode::ABX, FRM(abx_r)},
    {CORE(rol), AddrMode::ABX, FRM(abx_rmw)},
    {CORE(rla), AddrMode::ABX, FRM(abx_rmw)},
    // -- 4x
    {CORE(nop), AddrMode::IMP, FRM(rti)},
    {CORE(eor), AddrMode::IZX, FRM(izx_r)},
    {CORE(kil), AddrMode::IMP, FRM(imp)},
    {CORE(sre), AddrMode::IZX, FRM(izx_rmw)},
    {CORE(nop), AddrMode::ZP0, FRM(zp_r)},
    {CORE(eor), AddrMode::ZP0, FRM(zp_r)},
    {CORE(lsr), AddrMode::ZP0, FRM(zp_rmw)},
    {CORE(sre), AddrMode::ZP0, FRM(zp_rmw)},
    {CORE(nop), AddrMode::IMP, FRM(pha)},
    {CORE(eor), AddrMode::IMM, FRM(imm)},
    {CORE(lsr), AddrMode::ACC, FRM(acc)},
    {CORE(alr), AddrMode::IMM, FRM(imm)},
    {CORE(nop), AddrMode::ABS, FRM(abs_jmp)},
    {CORE(eor), AddrMode::ABS, FRM(abs_r)},
    {CORE(lsr), AddrMode::ABS, FRM(abs_rmw)},
    {CORE(sre), AddrMode::ABS, FRM(abs_rmw)},
    // -- 5x
    {CORE(bvc), AddrMode::REL, FRM(rel)},
    {CORE(eor), AddrMode::IZY, FRM(izy_r)},
    {CORE(kil), AddrMode::IMP, FRM(imp)},
    {CORE(sre), AddrMode::IZY, FRM(izy_rmw)},
    {CORE(nop), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(eor), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(lsr), AddrMode::ZPX, FRM(zpx_rmw)},
    {CORE(sre), AddrMode::ZPX, FRM(zpx_rmw)},
    {CORE(cli), AddrMode::IMP, FRM(imp)},
    {CORE(eor), AddrMode::ABY, FRM(aby_r)},
    {CORE(nop), AddrMode::IMP, FRM(imp)},
    {CORE(sre), AddrMode::ABY, FRM(aby_rmw)},
    {CORE(nop), AddrMode::ABX, FRM(abx_r)},
    {CORE(eor), AddrMode::ABX, FRM(abx_r)},
    {CORE(lsr), AddrMode::ABX, FRM(abx_rmw)},
    {CORE(sre), AddrMode::ABX, FRM(abx_rmw)},
    // -- 6x
    {CORE(nop), AddrMode::IMP, FRM(rts)},
    {CORE(adc), AddrMode::IZX, FRM(izx_r)},
    {CORE(kil), AddrMode::IMP, FRM(imp)},
    {CORE(rra), AddrMode::IZX, FRM(izx_rmw)},
    {CORE(nop), AddrMode::ZP0, FRM(zp_r)},
    {CORE(adc), AddrMode::ZP0, FRM(zp_r)},
    {CORE(ror), AddrMode::ZP0, FRM(zp_rmw)},
    {CORE(rra), AddrMode::ZP0, FRM(zp_rmw)},
    {CORE(nop), AddrMode::IMP, FRM(pla)},
    {CORE(adc), AddrMode::IMM, FRM(imm)},
    {CORE(ror), AddrMode::ACC, FRM(acc)},
    {CORE(arr), AddrMode::IMM, FRM(imm)},
    {CORE(nop), AddrMode::IND, FRM(ind_jmp)},
    {CORE(adc), AddrMode::ABS, FRM(abs_r)},
    {CORE(ror), AddrMode::ABS, FRM(abs_rmw)},
    {CORE(rra), AddrMode::ABS, FRM(abs_rmw)},
    // -- 7x
    {CORE(bvs), AddrMode::REL, FRM(rel)},
    {CORE(adc), AddrMode::IZY, FRM(izy_r)},
    {CORE(kil), AddrMode::IMP, FRM(imp)},
    {CORE(rra), AddrMode::IZY, FRM(izy_rmw)},
    {CORE(nop), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(adc), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(ror), AddrMode::ZPX, FRM(zpx_rmw)},
    {CORE(rra), AddrMode::ZPX, FRM(zpx_rmw)},
    {CORE(sei), AddrMode::IMP, FRM(imp)},
    {CORE(adc), AddrMode::ABY, FRM(aby_r)},
    {CORE(nop), AddrMode::IMP, FRM(imp)},
    {CORE(rra), AddrMode::ABY, FRM(aby_rmw)},
    {CORE(nop), AddrMode::ABX, FRM(abx_r)},
    {CORE(adc), AddrMode::ABX, FRM(abx_r)},
    {CORE(ror), AddrMode::ABX, FRM(abx_rmw)},
    {CORE(rra), AddrMode::ABX, FRM(abx_rmw)},
    // -- 8x
    {CORE(nop), AddrMode::IMM, FRM(imm)},
    {CORE(sta), AddrMode::IZX, FRM(izx_w)},
    {CORE(nop), AddrMode::IMM, FRM(imm)},
    {CORE(sax), AddrMode::IZX, FRM(izx_w)},
    {CORE(sty), AddrMode::ZP0, FRM(zp_w)},
    {CORE(sta), AddrMode::ZP0, FRM(zp_w)},
    {CORE(stx), AddrMode::ZP0, FRM(zp_w)},
    {CORE(sax), AddrMode::ZP0, FRM(zp_w)},
    {CORE(dey), AddrMode::IMP, FRM(imp)},
    {CORE(nop), AddrMode::IMM, FRM(imm)},
    {CORE(txa), AddrMode::IMP, FRM(imp)},
    {CORE(xaa), AddrMode::IMM, FRM(imm)},
    {CORE(sty), AddrMode::ABS, FRM(abs_w)},
    {CORE(sta), AddrMode::ABS, FRM(abs_w)},
    {CORE(stx), AddrMode::ABS, FRM(abs_w)},
    {CORE(sax), AddrMode::ABS, FRM(abs_w)},
    // -- 9x
    {CORE(bcc), AddrMode::REL, FRM(rel)},
    {CORE(sta), AddrMode::IZY, FRM(izy_w)},
    {CORE(kil), AddrMode::IMP, FRM(imp)},
    {CORE(ahx), AddrMode::IZY, FRM(izy_w)},
    {CORE(sty), AddrMode::ZPX, FRM(zpx_w)},
    {CORE(sta), AddrMode::ZPX, FRM(zpx_w)},
    {CORE(stx), AddrMode::ZPY, FRM(zpy_w)},
    {CORE(sax), AddrMode::ZPY, FRM(zpy_w)},
    {CORE(tya), AddrMode::IMP, FRM(imp)},
    {CORE(sta), AddrMode::ABY, FRM(aby_w)},
    {CORE(txs), AddrMode::IMP, FRM(imp)},
    {CORE(tas), AddrMode::ABY, FRM(aby_w)},
    {CORE(shy), AddrMode::ABX, FRM(abx_w)},
    {CORE(sta), AddrMode::ABX, FRM(abx_w)},
    {CORE(shx), AddrMode::ABY, FRM(aby_w)},
    {CORE(ahx), AddrMode::ABY, FRM(aby_w)},
    // -- Ax
    {CORE(ldy), AddrMode::IMM, FRM(imm)},
    {CORE(lda), AddrMode::IZX, FRM(izx_r)},
    {CORE(ldx), AddrMode::IMM, FRM(imm)},
    {CORE(lax), AddrMode::IZX, FRM(izx_r)},
    {CORE(ldy), AddrMode::ZP0, FRM(zp_r)},
    {CORE(lda), AddrMode::ZP0, FRM(zp_r)},
    {CORE(ldx), AddrMode::ZP0, FRM(zp_r)},
    {CORE(lax), AddrMode::ZP0, FRM(zp_r)},
    {CORE(tay), AddrMode::IMP, FRM(imp)},
    {CORE(lda), AddrMode::IMM, FRM(imm)},
    {CORE(tax), AddrMode::IMP, FRM(imp)},
    {CORE(lax), AddrMode::IMM, FRM(imm)},
    {CORE(ldy), AddrMode::ABS, FRM(abs_r)},
    {CORE(lda), AddrMode::ABS, FRM(abs_r)},
    {CORE(ldx), AddrMode::ABS, FRM(abs_r)},
    {CORE(lax), AddrMode::ABS, FRM(abs_r)},
    // -- Bx
    {CORE(bcs), AddrMode::REL, FRM(rel)},
    {CORE(lda), AddrMode::IZY, FRM(izy_r)},
    {CORE(kil), AddrMode::IMP, FRM(imp)},
    {CORE(lax), AddrMode::IZY, FRM(izy_r)},
    {CORE(ldy), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(lda), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(ldx), AddrMode::ZPY, FRM(zpy_r)},
    {CORE(lax), AddrMode::ZPY, FRM(zpy_r)},
    {CORE(clv), AddrMode::IMP, FRM(imp)},
    {CORE(lda), AddrMode::ABY, FRM(aby_r)},
    {CORE(tsx), AddrMode::IMP, FRM(imp)},
    {CORE(las), AddrMode::ABY, FRM(aby_r)},
    {CORE(ldy), AddrMode::ABX, FRM(abx_r)},
    {CORE(lda), AddrMode::ABX, FRM(abx_r)},
    {CORE(ldx), AddrMode::ABY, FRM(aby_r)},
    {CORE(lax), AddrMode::ABY, FRM(aby_r)},
    // -- Cx
    {CORE(cpy), AddrMode::IMM, FRM(imm)},
    {CORE(cmp), AddrMode::IZX, FRM(izx_r)},
    {CORE(nop), AddrMode::IMM, FRM(imm)},
    {CORE(dcp), AddrMode::IZX, FRM(izx_rmw)},
    {CORE(cpy), AddrMode::ZP0, FRM(zp_r)},
    {CORE(cmp), AddrMode::ZP0, FRM(zp_r)},
    {CORE(dec), AddrMode::ZP0, FRM(zp_rmw)},
    {CORE(dcp), AddrMode::ZP0, FRM(zp_rmw)},
    {CORE(iny), AddrMode::IMP, FRM(imp)},
    {CORE(cmp), AddrMode::IMM, FRM(imm)},
    {CORE(dex), AddrMode::IMP, FRM(imp)},
    {CORE(axs), AddrMode::IMM, FRM(imm)},
    {CORE(cpy), AddrMode::ABS, FRM(abs_r)},
    {CORE(cmp), AddrMode::ABS, FRM(abs_r)},
    {CORE(dec), AddrMode::ABS, FRM(abs_rmw)},
    {CORE(dcp), AddrMode::ABS, FRM(abs_rmw)},
    // -- Dx
    {CORE(bne), AddrMode::REL, FRM(rel)},
    {CORE(cmp), AddrMode::IZY, FRM(izy_r)},
    {CORE(kil), AddrMode::IMP, FRM(imp)},
    {CORE(dcp), AddrMode::IZY, FRM(izy_rmw)},
    {CORE(nop), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(cmp), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(dec), AddrMode::ZPX, FRM(zpx_rmw)},
    {CORE(dcp), AddrMode::ZPX, FRM(zpx_rmw)},
    {CORE(cld), AddrMode::IMP, FRM(imp)},
    {CORE(cmp), AddrMode::ABY, FRM(aby_r)},
    {CORE(nop), AddrMode::IMP, FRM(imp)},
    {CORE(dcp), AddrMode::ABY, FRM(aby_rmw)},
    {CORE(nop), AddrMode::ABX, FRM(abx_r)},
    {CORE(cmp), AddrMode::ABX, FRM(abx_r)},
    {CORE(dec), AddrMode::ABX, FRM(abx_rmw)},
    {CORE(dcp), AddrMode::ABX, FRM(abx_rmw)},
    // -- Ex
    {CORE(cpx), AddrMode::IMM, FRM(imm)},
    {CORE(sbc), AddrMode::IZX, FRM(izx_r)},
    {CORE(nop), AddrMode::IMM, FRM(imm)},
    {CORE(isc), AddrMode::IZX, FRM(izx_rmw)},
    {CORE(cpx), AddrMode::ZP0, FRM(zp_r)},
    {CORE(sbc), AddrMode::ZP0, FRM(zp_r)},
    {CORE(inc), AddrMode::ZP0, FRM(zp_rmw)},
    {CORE(isc), AddrMode::ZP0, FRM(zp_rmw)},
    {CORE(inx), AddrMode::IMP, FRM(imp)},
    {CORE(sbc), AddrMode::IMM, FRM(imm)},
    {CORE(nop), AddrMode::IMP, FRM(imp)},
    {CORE(sbc), AddrMode::IMM, FRM(imm)},
    {CORE(cpx), AddrMode::ABS, FRM(abs_r)},
    {CORE(sbc), AddrMode::ABS, FRM(abs_r)},
    {CORE(inc), AddrMode::ABS, FRM(abs_rmw)},
    {CORE(isc), AddrMode::ABS, FRM(abs_rmw)},
    // -- Fx
    {CORE(beq), AddrMode::REL, FRM(rel)},
    {CORE(sbc), AddrMode::IZY, FRM(izy_r)},
    {CORE(kil), AddrMode::IMP, FRM(imp)},
    {CORE(isc), AddrMode::IZY, FRM(izy_rmw)},
    {CORE(nop), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(sbc), AddrMode::ZPX, FRM(zpx_r)},
    {CORE(inc), AddrMode::ZPX, FRM(zpx_rmw)},
    {CORE(isc), AddrMode::ZPX, FRM(zpx_rmw)},
    {CORE(sed), AddrMode::IMP, FRM(imp)},
    {CORE(sbc), AddrMode::ABY, FRM(aby_r)},
    {CORE(nop), AddrMode::IMP, FRM(imp)},
    {CORE(isc), AddrMode::ABY, FRM(aby_rmw)},
    {CORE(nop), AddrMode::ABX, FRM(abx_r)},
    {CORE(sbc), AddrMode::ABX, FRM(abx_r)},
    {CORE(inc), AddrMode::ABX, FRM(abx_rmw)},
    {CORE(isc), AddrMode::ABX, FRM(abx_rmw)},
    /* clang-format on */
};

} // namespace ln
